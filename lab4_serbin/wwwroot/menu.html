<!DOCTYPE html>
<html>
<head>
    <title>Casdoor Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <h1>Welcome!</h1>
    <button id="loginBtn">Login with Casdoor</button>
    <pre id="userInfo"></pre>

    <script>
        document.getElementById("loginBtn").onclick = () => {
            const clientId = "fce836b52844f980c73c";
            const redirectUri = encodeURIComponent("https://localhost:5001/signin-casdoor");
            const casdoorUrl = `https://localhost:8443/login/oauth/authorize?client_id=${clientId}&response_type=code&redirect_uri=${redirectUri}`;
            window.location.href = casdoorUrl;
        };

        async function getUserInfo() {
            const response = await fetch("/userinfo");
            if (response.ok) {
                const data = await response.json();
                const keys = Object.keys(data).slice(0, 6);
                const shortData = {};
                keys.forEach(k => shortData[k] = data[k]);

                document.getElementById("userInfo").textContent = JSON.stringify(shortData, null, 2);
            }
        }

        getUserInfo();
    </script>
</body>
</html>
